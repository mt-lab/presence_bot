# presence_bot - бот присутствия
Телеграм-бот оповещения о присутствии в лабе. ESP8266 пингует shared хостинг, обновляя таймстамп. Исходя из разности времени второй скрипт сообщает на канале телеграм, работает ли плата, и как следствие, открыта ли лаба.

## Требования
- ESP8266 контроллер
- shared хостинг с php и доступом к cron

## Подготовка ESP
- Дополнительные ссылки для Менеджера плат в Arduino IDE: http://arduino.esp8266.com/stable/package_esp8266com_index.json
- Установка ESP8266 в Arduino IDE

## Подготовка сервера
- Обращаться к сайту ESP будет через 80 порт, так как  ESP тяжеловато осилить TLS самой, SSL сертификаты периодически меняют свои SHA-1 отпечатки, а перешивать плату очень не хочется. Поэтому см. следующий пункт
- Если в .htaccess прописан принудительный редирект с 80 на 443 порт, то необходимо добавить файл .updateTimestamp в исключения
- Интервал запуска задачи крона лучше ставить в 2-3 больше, чем интервал обновления таймстампа платы.

## Почему может не работать?
Так как в работе этого скрипта задействовано множество участников, то проблема может возникнуть где угодно. Можно проверить (от простого к сложному):
- есть ли питание у ESP?
- работает ли wi-fi? 
- указаны ли правильные данные для подключения платы к сети?
- находится ли ESP в зоне покрытия беспроводного роутера?
- возможно ли открыть php-скрипты через браузер?
- достаточно ли прав на php-скриптах (644)?
